<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Guided proposals · GuidedProposals.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">GuidedProposals.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../get_started/overview/">Get started</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">User manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Guided proposals</a><ul class="internal"><li><a class="tocitem" href="#Defining-the-target-law-1"><span>Defining the target law</span></a></li><li><a class="tocitem" href="#Defining-the-auxiliary-law-1"><span>Defining the auxiliary law</span></a></li><li><a class="tocitem" href="#Defining-the-terminal-observation-1"><span>Defining the terminal observation</span></a></li><li><a class="tocitem" href="#Initializing-GuidProp-1"><span>Initializing GuidProp</span></a></li><li><a class="tocitem" href="#Additional-options-for-GuidProp-definition-1"><span>Additional options for <code>GuidProp</code> definition</span></a></li></ul></li><li><a class="tocitem" href="../multiple_obs/">Multiple observations</a></li><li><a class="tocitem" href="../bffg/">BFFG algorithm</a></li><li><a class="tocitem" href="../convenience/">Convenience functions</a></li><li><a class="tocitem" href="../ode_type/">ODE systems</a></li><li><a class="tocitem" href="../additional_options/">Additional options</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">How to...</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../how_to_guides/sample_bridges/">Sample diffusion bridges</a></li><li><a class="tocitem" href="../../how_to_guides/first_passage_time/">Sample diffusions in first-passage time setting</a></li><li><a class="tocitem" href="../../how_to_guides/smoothing/">Do smoothing</a></li><li><a class="tocitem" href="../../how_to_guides/parameter_inference/">Do parameter inference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/smoothing/">Smoothing/Imputation</a></li><li><a class="tocitem" href="../../tutorials/parameter_inference/">Parameter inference</a></li></ul></li><li><a class="tocitem" href="../../module_index/">Index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">User manual</a></li><li class="is-active"><a href>Guided proposals</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Guided proposals</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaDiffusionBayes/GuidedProposals.jl/blob/master/docs/src/manual/guid_prop.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Defining-guided-proposals-1"><a class="docs-heading-anchor" href="#Defining-guided-proposals-1">Defining guided proposals</a><a class="docs-heading-anchor-permalink" href="#Defining-guided-proposals-1" title="Permalink"></a></h1><hr/><p>The main object used to define guided proposals is</p><article class="docstring"><header><a class="docstring-binding" id="GuidedProposals.GuidProp" href="#GuidedProposals.GuidProp"><code>GuidedProposals.GuidProp</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">struct GuidProp{
        K,DP,DW,SS,R,R2,O,S,T
        } &lt;: DiffusionDefinition.DiffusionProcess{K,DP,DW,SS}
    P_target::R
    P_aux::R2
    obs::O
    guiding_term_solver::S
end</code></pre><p>Struct defining <code>guided proposals</code> of <em>M Schauer, F van der Meulen and H van Zanten</em>. See <em>Mider M, Schauer M and van der Meulen F</em> &quot;Continuous-discrete smoothing of diffusions&quot; (2020) for a comprehensive overview of the mathematics behind this object. It computes and stores the guiding term <code>∇logρ</code> and allows for simulation of guided proposals and computation of their likelihood.</p><pre><code class="language-none">GuidProp(
        tt,
        P_target::R,
        P_aux_type::Type{TR2},
        obs::O,
        solver_choice=(
            solver=Tsit5(),
            ode_type=:HFc,
            convert_to_HFc=false,
            mode=:inplace,
            gradients=false,
            eltype=Float64,
        ),
        next_guided_prop=nothing
    ) where {
        R&lt;:DD.DiffusionProcess,
        TR2&lt;:DD.DiffusionProcess,
        O&lt;:OBS.Observation
    }</code></pre><p>Default constructor. <code>P_target</code> and <code>P_aux</code> are the target and the type of the auxiliary diffusion laws respectively, <code>tt</code> is the time-grid on which <code>∇logρ</code> needs to be computed. <code>obs</code> is the terminal observation (and the only one on the interval (<code>tt[1]</code>, <code>tt[end]</code>]). <code>solver_choice</code> specifies the type of ODE solver that is to be used for computations of <code>∇logρ</code>     ( it is a <code>NamedTuple</code>, where <code>solver</code> specifies the algorithm for solving     ODEs (see the documentation of DifferentialEquations.jl for possible     choices), <code>ode_type</code> picks the ODE system (between :HFc, :MLμ and :Pν),     <code>convert_to_HFc</code> indicates whether to translate the results of M,L,μ solver     to H,F,c objects, <code>mode</code> is a flag indicating the way in which data is being     handled:     - <code>:inplace</code>: uses regular arrays to store the data (requires functions                   B!, β!, σ! and a! to be defined)     - <code>:outofplace</code>: operates on static arrays     - <code>:gpu</code>: operates on GPU arrays [TODO not implemented yet]     <code>gradients</code> is a flag indicating whether automatic differentiation is to     be employed and <code>eltype</code> indicates the data-type of each container&#39;s     member. ) Finally, <code>next_guided_prop</code> is the guided proposal for the subsequent inter-observation interval.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDiffusionBayes/GuidedProposals.jl/blob/4485c99a9824eac446848fecf3c104988a8a570e/src/guided_proposals.jl#LL7-L63">source</a></section></article><p>The main role of this object is to facilitate sampling of diffusion paths from some <code>target</code> diffusion law by:</p><ul><li>drawing from a <code>proposal</code> diffusion law &amp;</li><li>computing an importance sampling weight</li></ul><p>Performing these two steps in a setting of importance sampling or mcmc sampling makes it possible to draw sample-paths from the <code>target</code> law.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>From the conceptual point of view, the target and auxiliary laws, as well as the terminal observations are all required to define a guided proposal. However, conceptually, guided proposals are defined as continuous-time processes, and thus, it should be possible to look-up the value of any sampled trajectory at any time <span>$t\in[0,T]$</span>. <code>tt</code>— the time grid on which the path is to be revealed—is thus conceptually superfluous at the time of initialization. Nonetheless, for the purposes that this package was created fixing a time-grid <code>tt</code> at initialization of any <code>GuidProp</code> is helpful in reducing the computational cost of the algorithm. Currently, if sampling on finer grid is needed at any point, then <code>GuidProp</code> object needs to be redefined.</p></div></div><h2 id="Defining-the-target-law-1"><a class="docs-heading-anchor" href="#Defining-the-target-law-1">Defining the target law</a><a class="docs-heading-anchor-permalink" href="#Defining-the-target-law-1" title="Permalink"></a></h2><hr/><p>To define the target law we should make use another package from the <a href="https://github.com/JuliaDiffusionBayes/">JuliaDiffusionBayes</a> suite: <a href="https://github.com/JuliaDiffusionBayes/DiffusionDefinition.jl">DiffusionDefinition.jl</a>. We can either define the target law using the macro <code>@define_diffusion</code> or—if we can—simply load in a pre-defined processes.</p><div class="admonition is-success"><header class="admonition-header">Running example—Lotka-Volterra model—defining the target law</header><div class="admonition-body"><pre><code class="language-julia">using DiffusionDefinition
const DD = DiffusionDefinition
@load_diffusion LotkaVolterra # for constructing the target law

θ = [2.0/3.0, 4.0/3.0, 1.0, 1.0, 0.2, 0.2]
P_target = LotkaVolterra(θ...)</code></pre></div></div><h2 id="Defining-the-auxiliary-law-1"><a class="docs-heading-anchor" href="#Defining-the-auxiliary-law-1">Defining the auxiliary law</a><a class="docs-heading-anchor-permalink" href="#Defining-the-auxiliary-law-1" title="Permalink"></a></h2><hr/><p>When we pass the auxiliary law to <code>GuidProp</code> we pass only the name of a struct that defines it and not the actual instance of it. The object will be initialized internally by <code>GuidProp</code>. For this reason, the following convention <strong>MUST</strong> be adhered to:</p><ul><li>the auxiliary law is limited to having the same parameter names as the target law; internally <code>GuidProp</code> cycles through all parameters needed by the auxiliary law and looks for the corresponding entry in the target law, using the value of the parameters found there. Importantly the association is done <strong>by name</strong></li><li>in addition to parameters the auxiliary law is expected to have the following fields of the type <code>:auxiliary_info</code>:<ul><li><code>:t0</code></li><li><code>:T</code> and</li><li><code>:vT</code></li></ul></li></ul><p>Additionally, the field <code>:xT</code> will be defined automatically and (if need be) auto-initialized (but can also be declared explicitly).</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>No other field from <code>:auxiliary_info</code> (apart from explicitly declaring <code>:xT</code>) can be used (i.e. fields <code>:v0</code> and <code>:x0</code>). This last restriction will probably be relaxed in the near future.</p></div></div><div class="admonition is-success"><header class="admonition-header">Running example—Lotka-Volterra model—defining the auxiliary law</header><div class="admonition-body"><pre><code class="language-julia">@load_diffusion LotkaVolterraAux</code></pre></div></div><h2 id="Defining-the-terminal-observation-1"><a class="docs-heading-anchor" href="#Defining-the-terminal-observation-1">Defining the terminal observation</a><a class="docs-heading-anchor-permalink" href="#Defining-the-terminal-observation-1" title="Permalink"></a></h2><hr/><p>To define the terminal observation we should make use of another package from the <a href="https://github.com/JuliaDiffusionBayes/JuliaDiffusionBayes.jl">JuliaDiffusionBayes.jl</a> suite: <a href="https://github.com/JuliaDiffusionBayes/ObservationSchemes.jl">ObservationSchemes.jl</a>.</p><div class="admonition is-success"><header class="admonition-header">Running example—Lotka-Volterra model—defining the observation</header><div class="admonition-body"><p>Let&#39;s initialize an observation sampled according to a scheme: $ v=X+\eta,\quad \eta\sim N(0,I). $</p><pre><code class="language-julia">using ObservationSchemes, StaticArrays
t, xₜ = 2.0, (@SVector [1.0, 2.0])
obs = LinearGsnObs(t, xₜ; Σ = SDiagonal(1.0, 1.0))</code></pre></div></div><h2 id="Initializing-GuidProp-1"><a class="docs-heading-anchor" href="#Initializing-GuidProp-1">Initializing GuidProp</a><a class="docs-heading-anchor-permalink" href="#Initializing-GuidProp-1" title="Permalink"></a></h2><p>It is now possible to define <code>GuidProp</code>. We may define the time-grid and then leave the remaining parameters at their defaults. At initialization time a sequence of computations is performed that derive a <code>guiding term</code> for <code>t</code>&#39;s lying on a pre-specified time-grid <code>tt</code>, as well as some additional quantities need for computations of the <code>log-likelihoods</code>.</p><div class="admonition is-success"><header class="admonition-header">Running example—Lotka-Volterra model—defining GuidProp</header><div class="admonition-body"><pre><code class="language-julia">dt = 0.001
tt = 0.0:dt:t
P = GuidProp(tt, P_target, LotkaVolterraAux, obs)</code></pre></div></div><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>If at any point the parameters change, then the <code>guiding term</code> might need to be re-computed (in fact, this is the centerpiece of the <code>backward filtering</code> part of the <code>forward filtering-backward guiding</code> algorithm). We provide certain utility functions that facilitate these operations. See ... for more details.</p></div></div><h2 id="Additional-options-for-GuidProp-definition-1"><a class="docs-heading-anchor" href="#Additional-options-for-GuidProp-definition-1">Additional options for <code>GuidProp</code> definition</a><a class="docs-heading-anchor-permalink" href="#Additional-options-for-GuidProp-definition-1" title="Permalink"></a></h2><hr/><p>Additional set of options passed to <code>GuidProp</code> are specified in the field <code>solver_choice</code>, which by default is set to:</p><pre><code class="language-julia">solver_choice=(
      solver=Tsit5(),
      ode_type=:HFc,
      convert_to_HFc=false,
      mode=:outofplace,
      gradients=false,
      eltype=Float64,
)</code></pre><p>The constructor expects it to be a NamedTuple with the respective fields (but it is robust enough to fill-in any missing fields with defaults). The meaning of the fields is as follows:</p><ul><li><code>solver</code> is passed to <code>DifferentialEquations.jl</code> to pick an algorithm for solving ODEs that define the guiding term. More about the ODE systems is written in the following section.</li><li><code>ode_type</code> is used to pick between three choices of ODE systems to use: <code>H</code>, <code>F</code>, <code>c</code> system, <code>M</code>, <code>L</code>, <code>μ</code> system and <code>P</code>, <code>ν</code> (and <code>c</code>, but <code>c</code> needs to be added to names). They have the labels: <code>:HFc</code>, <code>MLμ</code>, <code>Pν</code> respectively, which are not case sensitive and currently only <code>HFc</code> is implemented)</li><li><code>convert_to_HFc</code> is used only when <code>:MLμ</code> has been chosen to be a solver of ODEs. In that scenario, if <code>convert_to_HFc</code> is set to <code>true</code>, then the terms <code>M</code>, <code>L</code>, <code>μ</code> that the ODE systems solve for will be used to compute the corresponding <code>H</code>, <code>F</code>, <code>c</code> terms (as opposed to using <code>:HFc</code> solver to solve for them)</li><li><code>mode</code> is an important flag (currently only <code>:outofplace</code> is fully supported) and it is used to tell <code>GuidProp</code> what type of computations are being performed: out-of-place <code>:outofplace</code>, which are based on <code>SVector</code>s from (StaticArrays.jl)[https://github.com/JuliaArrays/StaticArrays.jl], in-place <code>:inplace</code>, which are based on <code>Vector</code>s or <code>:gpu</code>, which are based on <code>cuArray</code>s.</li><li><code>gradients</code> is another important flag for telling <code>GuidProp</code> whether gradients with respect to something need to be computed.</li><li><code>eltype</code> ignore this for a moment, we need to figure some things out with this...</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../get_started/overview/">« Get started</a><a class="docs-footer-nextpage" href="../multiple_obs/">Multiple observations »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 11 May 2020 15:39">Monday 11 May 2020</span>. Using Julia version 1.4.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
