<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Reparameterizations · GuidedProposals.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">GuidedProposals.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../get_started/overview/">Get started</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">User manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../guid_prop/">Guided proposals</a></li><li><a class="tocitem" href="../multiple_obs/">Multiple observations</a></li><li><a class="tocitem" href="../log_likelihood/">Log-likelihoods</a></li><li class="is-active"><a class="tocitem" href>Reparameterizations</a><ul class="internal"><li><a class="tocitem" href="#Example-1"><span>Example</span></a></li><li><a class="tocitem" href="#recompute_guiding_term-1"><span>Re-computing the guiding term</span></a></li></ul></li><li><a class="tocitem" href="../bffg/">BFFG algorithm</a></li><li><a class="tocitem" href="../path_functionals/">Computing path functionals</a></li><li><a class="tocitem" href="../ode_type/">ODE systems</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">How to...</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../how_to_guides/sample_bridges/">Sample diffusion bridges</a></li><li><a class="tocitem" href="../../how_to_guides/first_passage_time/">Sample diffusions in first-passage time setting</a></li><li><a class="tocitem" href="../../how_to_guides/smoothing/">Do smoothing</a></li><li><a class="tocitem" href="../../how_to_guides/parameter_inference/">Do parameter inference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/in_place_vs_out_of_place/">Understanding in-place vs out-of-place</a></li><li><a class="tocitem" href="../../tutorials/smoothing/">Smoothing/Imputation</a></li><li><a class="tocitem" href="../../tutorials/parameter_inference/">Parameter inference</a></li></ul></li><li><a class="tocitem" href="../../module_index/">Index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">User manual</a></li><li class="is-active"><a href>Reparameterizations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Reparameterizations</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaDiffusionBayes/GuidedProposals.jl/blob/master/docs/src/manual/reparameterizations.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Reparameterizations-of-GuidProp-1"><a class="docs-heading-anchor" href="#Reparameterizations-of-GuidProp-1">Reparameterizations of <code>GuidProp</code></a><a class="docs-heading-anchor-permalink" href="#Reparameterizations-of-GuidProp-1" title="Permalink"></a></h1><hr/><p>In an MCMC setting we may wish to change the values of some parameters of <code>GuidProp</code>. <code>GuidProp</code> is defined as an immutable struct, so in-place change will usually be impossible; however, we can use a function <code>clone</code> to create a new instance of <code>GuidProp</code> with new parameter values and the remaining containers simply kept unchanged from a previous <code>GuidProp</code> instance</p><article class="docstring"><header><a class="docstring-binding" id="ObservationSchemes.clone" href="#ObservationSchemes.clone"><code>ObservationSchemes.clone</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">ObservationSchemes.clone(P::GuidProp, θ°, η°)</code></pre><p>Create a new guided proposal object with new parameters <code>θ°</code> parametrizing the diffusion laws and <code>η°</code> parametrizing the observations. Keep the pre-allocated spaces for solvers unchanged. Note that <code>θ°</code> must be a dictionary correspond to parameters returned when calling DD.var_parameters() on the target and auxiliary laws.</p><p>TODO this is a convenience method that is not really used and doesn&#39;t properly work yet.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDiffusionBayes/GuidedProposals.jl/blob/45f0d3dd54355c476e7ea455ac51838e5d95da49/src/reparameterizations.jl#LL2-L13">source</a></section><section><div><pre><code class="language-julia">ObservationSchemes.clone(P::GuidProp, ξ, invcoords, θ°idx, η°idx)</code></pre><p>Create a new guided proposal object with new parameters (slightly akward method, but optimized for speed in an MCMC setting). <code>ξ</code> should contain all parameters that are changing. It is a sub-vector of a larger <code>global</code> vector <code>ξ°</code>. The positions taken by <code>ξ</code> in <code>ξ°</code> are given by <code>sub_idx</code> (which is not known to a method), and <code>invcoords</code> is a dictionary that for each entry in <code>sub_idx</code> gives a corresponding index of <code>ξ</code>. The indices of <code>ξ°</code> that constitute parameters to be passed to cloning of law are listed in <code>θ°idx</code>. In particular, if <code>θ°idx</code> were just a list of indices, then <code>θ° = ξ°[θ°idx]</code>. However, <code>θ°idx</code> additionally contains parameter names. <code>η°idx</code> does the same but for the observation. Keeps the pre-allocated spaces for solvers unchanged.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDiffusionBayes/GuidedProposals.jl/blob/45f0d3dd54355c476e7ea455ac51838e5d95da49/src/reparameterizations.jl#LL27-L40">source</a></section></article><p>The first clone method is not working yet (but it&#39;s also not of much use). The second method seems a bit convoluted, but it is all for optimizing performance for the MCMC setting. To understand how to use it consider the following example:</p><h2 id="Example-1"><a class="docs-heading-anchor" href="#Example-1">Example</a><a class="docs-heading-anchor-permalink" href="#Example-1" title="Permalink"></a></h2><hr/><pre><code class="language-julia"># This `global vector` corresponds to all parameters of the MCMC chain
# (possibly many more than there in a single GuidProp)
ξ° = collect(1.0:10.0)

# These coordinates of the global vector are relevant for a `clone` call
sub_idx = [3, 5, 7]

# To each coordinate in `sub_idx` associate an index in `ξ`
invcoords = Dict(
	3 =&gt; 1,
	5 =&gt; 2,
	7 =&gt; 3,
)

# build `local vector` (corresponding to a local update of an MCMC chain)
ξ = ξ°[sub_idx] # [3.0, 5.0, 7.0]

# info on which parameters to update. For laws associate by name,
# for observations (not considered here) associate by position (instead of pname use local_idx)
θ°idx = [
	(global_idx=sub_idx[1], pname=:β),
	(global_idx=sub_idx[2], pname=:γ),
	(global_idx=sub_idx[3], pname=:α),
]

# clone
P_cloned = GP.clone(P, ξ, invcoords, θ°idx, [])</code></pre><p>Now we have:</p><pre><code class="language-julia">julia&gt; DD.var_parameters(P_cloned.P_target)
Dict{Symbol,Float64} with 6 entries:
  :α  =&gt; 7.0
  :γ  =&gt; 5.0
  :δ  =&gt; 1.0
  :β  =&gt; 3.0
  :σ2 =&gt; 0.1
  :σ1 =&gt; 0.1

julia&gt; DD.var_parameters(P_cloned.P_aux) == DD.var_parameters(P_cloned.P_target)
true</code></pre><h2 id="recompute_guiding_term-1"><a class="docs-heading-anchor" href="#recompute_guiding_term-1">Re-computing the guiding term</a><a class="docs-heading-anchor-permalink" href="#recompute_guiding_term-1" title="Permalink"></a></h2><hr/><p>Sometimes changing parameter values is all that needs to be done; however, it is not always the case. Often changing parameter values implies that the terms used for computation of the guiding term also need to be updated. This needs to be done whenever any parameter of the auxiliary law or any parameter of an observation has changed. To check whether such parameters have been changed call <code>critical_parameters_changed</code> on the last two arguments that were passed to <code>clone</code>:</p><article class="docstring"><header><a class="docstring-binding" id="GuidedProposals.critical_parameters_changed" href="#GuidedProposals.critical_parameters_changed"><code>GuidedProposals.critical_parameters_changed</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">critical_parameters_changed(P::GuidProp, θ°idx, η°idx)</code></pre><p>Return a boolean flag for whether the changed parameters (listed in <code>θ°idx</code> and <code>η°idx</code>) prompt for re-computation of the guiding term.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDiffusionBayes/GuidedProposals.jl/blob/45f0d3dd54355c476e7ea455ac51838e5d95da49/src/reparameterizations.jl#LL71-L76">source</a></section><section><div><pre><code class="language-julia">critical_parameters_changed(_P_type::Type{&lt;:GuidProp}, θ°idx, η°idx)</code></pre><p>Return a boolean flag for whether the changed parameters (listed in <code>θ°idx</code> and <code>η°idx</code>) prompt for re-computation of the guiding term.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDiffusionBayes/GuidedProposals.jl/blob/45f0d3dd54355c476e7ea455ac51838e5d95da49/src/reparameterizations.jl#LL81-L86">source</a></section></article><p>To actually re-compute the guiding terms and finalize the reparameterization you need to call</p><article class="docstring"><header><a class="docstring-binding" id="GuidedProposals.recompute_guiding_term!" href="#GuidedProposals.recompute_guiding_term!"><code>GuidedProposals.recompute_guiding_term!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">recompute_guiding_term!(P::GuidProp, next_guided_prop=nothing)</code></pre><p>Recompute the guiding term (most often used after update of parameters or change of an observation). <code>next_guided_prop</code> is the guided proposal law from the subsequent interval</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDiffusionBayes/GuidedProposals.jl/blob/45f0d3dd54355c476e7ea455ac51838e5d95da49/src/guided_proposals.jl#LL340-L346">source</a></section><section><div><pre><code class="language-julia">recompute_guiding_term!(PP::Vector{&lt;:GuidProp})</code></pre><p>Recompute the guiding term for the entire trajectory with all observations (most often used after update of parameters or change of an observation).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDiffusionBayes/GuidedProposals.jl/blob/45f0d3dd54355c476e7ea455ac51838e5d95da49/src/guided_proposals.jl#LL358-L363">source</a></section></article><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"></div></div><pre><code class="language-none">	If a call to `recompute_guiding_term!` was made on a cloned law `P_cloned` (cloned from the original `P_orig`), then it would not only change the guiding term of `P_cloned`, but also that of `P_orig`. The reason for that is that the call to `clone` simply passes directly to `P_cloned` the same containers for the guiding term solving machinery that were used in `P_orig`.</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../log_likelihood/">« Log-likelihoods</a><a class="docs-footer-nextpage" href="../bffg/">BFFG algorithm »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 15 May 2020 14:58">Friday 15 May 2020</span>. Using Julia version 1.4.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
